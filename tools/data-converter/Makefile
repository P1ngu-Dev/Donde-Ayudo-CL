# Makefile para Data Converter

# Variables
BINARY_NAME=data-converter
GO_FILES=$(shell find . -name '*.go' -not -path "./vendor/*")
BUILD_DIR=build
VERSION=1.0.0

.PHONY: all build run clean test deps help install

# Default target
all: build

## build: Compilar el binario
build:
	@echo "ğŸ”¨ Compilando..."
	@go build -o $(BINARY_NAME) -ldflags "-s -w -X main.version=$(VERSION)" .
	@echo "âœ… Compilado: $(BINARY_NAME)"

## install: Instalar dependencias
deps:
	@echo "ğŸ“¦ Instalando dependencias..."
	@go mod download
	@go mod tidy
	@echo "âœ… Dependencias instaladas"

## run: Compilar y ejecutar con argumentos de ejemplo
run: build
	@echo "ğŸš€ Ejecutando..."
	@./$(BINARY_NAME) -verbose

## test: Ejecutar tests
test:
	@echo "ğŸ§ª Ejecutando tests..."
	@go test -v ./...

## clean: Limpiar binarios y cachÃ©
clean:
	@echo "ğŸ§¹ Limpiando..."
	@rm -f $(BINARY_NAME)
	@rm -rf $(BUILD_DIR)
	@rm -f geocache.json
	@go clean
	@echo "âœ… Limpieza completada"

## build-all: Compilar para todas las plataformas
build-all:
	@echo "ğŸ”¨ Compilando para todas las plataformas..."
	@./build.sh

## install: Instalar el binario en el sistema
install: build
	@echo "ğŸ“¥ Instalando en /usr/local/bin..."
	@sudo cp $(BINARY_NAME) /usr/local/bin/
	@echo "âœ… Instalado: /usr/local/bin/$(BINARY_NAME)"

## fmt: Formatear cÃ³digo
fmt:
	@echo "âœ¨ Formateando cÃ³digo..."
	@go fmt ./...
	@echo "âœ… CÃ³digo formateado"

## vet: Verificar cÃ³digo
vet:
	@echo "ğŸ” Verificando cÃ³digo..."
	@go vet ./...
	@echo "âœ… VerificaciÃ³n completada"

## lint: Ejecutar linter (requiere golangci-lint)
lint:
	@echo "ğŸ” Ejecutando linter..."
	@golangci-lint run ./...

## dev: Modo desarrollo con recompilaciÃ³n automÃ¡tica
dev:
	@echo "ğŸ‘¨â€ğŸ’» Modo desarrollo..."
	@go run . -verbose -input ../../src/data/data1.csv -output ../../src/data/data1.json

## help: Mostrar esta ayuda
help:
	@echo "Comandos disponibles:"
	@sed -n 's/^##//p' $(MAKEFILE_LIST) | column -t -s ':' | sed -e 's/^/ /'

.DEFAULT_GOAL := help
